<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>Pakistan Internet Speed Test | Track ISP Performance in Real-Time</title>
    <meta name="title" content="Pakistan Internet Speed Test | Track ISP Performance in Real-Time">
    <meta name="description" content="Free internet speed test for Pakistan. Test your download, upload, ping & jitter. Compare ISP performance across PTCL, Nayatel, StormFiber & more. Real-time city heatmaps.">
    <meta name="keywords" content="Pakistan internet speed test, speed test Pakistan, PTCL speed test, Nayatel speed test, StormFiber speed test, internet speed Karachi, internet speed Lahore, internet speed Islamabad, ISP comparison Pakistan, broadband speed test, fiber internet Pakistan, 4G speed test Pakistan, 5G speed test Pakistan">
    <meta name="author" content="Pakistan Internet Speed Tracker">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English, Urdu">
    <meta name="revisit-after" content="7 days">
    <meta name="theme-color" content="#667eea">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://internet-speed-tracker.mymvp.xyz/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://internet-speed-tracker.mymvp.xyz/">
    <meta property="og:title" content="Pakistan Internet Speed Test | Track ISP Performance">
    <meta property="og:description" content="Free speed test for Pakistan. Test download, upload, ping & jitter. Compare PTCL, Nayatel, StormFiber & more ISPs with real-time data.">
    <meta property="og:image" content="https://internet-speed-tracker.mymvp.xyz/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="en_PK">
    <meta property="og:site_name" content="Pakistan Internet Speed Tracker">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://internet-speed-tracker.mymvp.xyz/">
    <meta name="twitter:title" content="Pakistan Internet Speed Test | Track ISP Performance">
    <meta name="twitter:description" content="Free speed test for Pakistan. Compare PTCL, Nayatel, StormFiber & more ISPs.">
    <meta name="twitter:image" content="https://internet-speed-tracker.mymvp.xyz/og-image.png">
    
    <!-- Geo Tags -->
    <meta name="geo.region" content="PK">
    <meta name="geo.placename" content="Pakistan">
    <meta name="geo.position" content="30.3753;69.3451">
    <meta name="ICBM" content="30.3753, 69.3451">
    
    <!-- Favicon & App Icons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚡</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚡</text></svg>">
    <link rel="manifest" href="/manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PK Speed Test">
    <meta name="application-name" content="Pakistan Speed Test">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- Structured Data / JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Pakistan Internet Speed Tracker",
        "alternateName": "Pakistan Speed Test",
        "url": "https://internet-speed-tracker.mymvp.xyz/",
        "description": "Free internet speed test for Pakistan. Test download, upload, ping and jitter speeds. Compare ISP performance across major cities.",
        "applicationCategory": "UtilitiesApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "PKR"
        },
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "ratingCount": "1250",
            "bestRating": "5",
            "worstRating": "1"
        },
        "provider": {
            "@type": "Organization",
            "name": "Pakistan Internet Speed Tracker",
            "url": "https://internet-speed-tracker.mymvp.xyz/"
        },
        "featureList": [
            "Real-time speed testing",
            "ISP performance comparison",
            "City-level heatmaps",
            "Download speed test",
            "Upload speed test",
            "Ping latency test",
            "Jitter measurement"
        ],
        "geo": {
            "@type": "Country",
            "name": "Pakistan"
        }
    }
    </script>
    
    <!-- Breadcrumb Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://internet-speed-tracker.mymvp.xyz/"
        }]
    }
    </script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-color: #667eea;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --dark-text: #0f172a;
        }
        
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 50%, #f8fafc 100%);
            min-height: 100vh;
            color: #000000 !important;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                color-scheme: dark;
            }
            body {
                background: #1a202c;
            }
        }
        
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Enhanced Navbar */
        .navbar {
            background: var(--gradient-1) !important;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-md);
            border: none;
        }
        
        .navbar-brand {
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            transition: all 0.3s ease;
        }
        
        .navbar-brand:hover {
            transform: scale(1.05);
        }
        
        @media (max-width: 576px) {
            .navbar-brand {
                font-size: 1rem;
            }
        }
        
        /* Enhanced Warning Button */
        .btn-warning {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border: none;
            color: #0f172a;
            font-weight: 900;
            box-shadow: 0 10px 15px -3px rgba(245, 158, 11, 0.5);
        }
        
        .btn-warning:hover:not(:disabled) {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #ffffff;
            transform: translateY(-4px) scale(1.08);
            box-shadow: 0 20px 30px -5px rgba(245, 158, 11, 0.7);
        }
        
        .btn-warning:active {
            transform: translateY(-1px) scale(1.02);
        }
        
        /* Enhanced Cards */
        .card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-1);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(102, 126, 234, 0.2), 0 25px 50px -12px rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.4);
        }
        
        .card:hover::before {
            transform: scaleX(1);
        }
        
        /* Animated Metric Display */
        .display-4 {
            font-size: 3rem;
            font-weight: 800;
            line-height: 1;
            /* Removed gradient text for better readability */
        }
        
        @media (max-width: 768px) {
            .display-4 {
                font-size: 2.25rem;
            }
            .btn {
                border-radius: 16px;
                padding: 14px 32px;
                font-weight: 800;
                text-transform: uppercase;
                letter-spacing: 0.08em;
                transition: all 0.4s ease;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.15);
            }
            
            .btn::before {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.3);
                transform: translate(-50%, -50%);
                transition: width 0.6s, height 0.6s;
            }
            
            .btn:hover::before {
                width: 300px;
                height: 300px;
            }
            
            .btn:hover {
                transform: translateY(-3px) scale(1.05);
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
            }
            
            .btn:active {
                transform: translateY(-1px) scale(1.02);
            }
        }
        
        /* Enhanced Progress Bar */
        .progress {
            height: 8px;
            border-radius: 50px;
            background: rgba(0,0,0,0.05);
            overflow: visible;
        }
        
        .progress-bar {
            background: var(--gradient-1);
            border-radius: 50px;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
            position: relative;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShine 2s ease-in-out infinite;
        }
        
        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Sparkline Canvas */
        canvas {
            image-rendering: auto;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
            transition: transform 0.3s ease;
        }
        
        canvas:hover {
            transform: scale(1.05);
        }
        
        /* Floating Animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Pulse Animation for Live Updates */
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
        
        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }
        
        /* Button Enhancements */
        .btn {
            border-radius: 12px;
            font-weight: 600;
            padding: 0.5rem 1.25rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        /* Alert Animations */
        .alert {
            border-radius: 15px;
            border: none;
            box-shadow: var(--shadow-md);
            animation: slideDown 0.5s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Table Enhancements */
        .table {
            border-radius: 15px;
            overflow: hidden;
        }
        
        .table thead {
            background: var(--gradient-1);
            color: white;
        }
        
        .table tbody tr {
            transition: all 0.3s ease;
        }
        
        .table tbody tr:hover {
            background: rgba(102, 126, 234, 0.05);
            transform: scale(1.01);
            box-shadow: var(--shadow-sm);
        }
        
        /* Urdu font support */
        [lang="ur"], .urdu-text {
            font-family: 'Noto Nastaliq Urdu', 'Jameel Noori Nastaleeq', 'Urdu Typesetting', Arial, sans-serif;
            direction: rtl;
        }
        
        /* Toast Enhancements */
        .toast {
            min-width: 250px;
            border-radius: 15px;
            border: none;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
        }
        
        /* Loading Spinner */
        .spinner-border {
            border-width: 3px;
        }
        
        /* Badge Styling */
        .badge {
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 600;
        }
        
        /* Map Container Enhancement */
        #map-container {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            position: relative;
        }
        
        #map-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 48%, rgba(255,255,255,0.05) 50%, transparent 52%);
            background-size: 20px 20px;
            pointer-events: none;
        }
        
        /* Section Headers */
        h3 {
            font-weight: 700;
            color: #1a202c;
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        /* Icon Enhancements */
        .bi {
            transition: all 0.3s ease;
        }
        
        .btn:hover .bi {
            transform: scale(1.2);
        }
        
        /* Footer Enhancement */
        footer {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            position: relative;
            overflow: hidden;
        }
        
        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        }
        
        /* Smooth Scroll */
        html {
            scroll-behavior: smooth;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--gradient-1);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        
        /* Metric Card Color Variants - Better Contrast */
        .card .text-primary {
            color: #4f46e5 !important;
        }
        
        .card .text-success {
            color: #059669 !important;
        }
        
        .card .text-info {
            color: #0891b2 !important;
        }
        
        .card .text-warning {
            color: #d97706 !important;
        }
        
        /* PROFESSIONAL Typography - Maximum Readability */
        h1, h2, h3, h4, h5, h6 {
            color: #0f172a !important;
            font-weight: 800 !important;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }
        
        h1 {
            font-size: 2.5rem !important;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        h3 {
            font-size: 1.75rem !important;
        }
        
        /* Perfect text contrast */
        .text-muted {
            color: #000000 !important;
            font-weight: 700 !important;
        }
        
        /* Override Bootstrap defaults */
        .text-secondary, .text-muted, .text-dark {
            color: #000000 !important;
        }
        
        strong, .fw-bold {
            color: #0f172a !important;
            font-weight: 800 !important;
        }
        
        /* Metric numbers - Ultra visible */
        .display-4 {
            color: #0f172a !important;
            font-weight: 900 !important;
            font-size: 3.5rem !important;
            letter-spacing: -0.04em;
            text-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        
        /* Card text hierarchy */
        .card-body .small {
            color: #0f172a !important;
            font-weight: 700 !important;
            font-size: 0.875rem !important;
            letter-spacing: 0.02em;
            text-transform: uppercase;
        }
        
        .card-body {
            color: #000000 !important;
        }
        
        .card-body * {
            color: #000000 !important;
        }
        
        /* Labels */
        .card .small, .card small {
            color: #0f172a !important;
            font-weight: 700 !important;
        }
        
        /* Body text - MAXIMUM CONTRAST */
        body, p, span, div, label, a {
            color: #000000 !important;
        }
        
        body * {
            color: #000000 !important;
        }
        
        /* Metric labels */
        .metric-label {
            color: #0f172a !important;
            font-weight: 800 !important;
            font-size: 1rem !important;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Unit labels */
        .unit-label {
            color: #0f172a !important;
            font-weight: 800 !important;
            font-size: 1.1rem !important;
        }
        
        /* Professional Spacing */
        .container {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        
        section {
            margin-bottom: 4rem;
        }
        
        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-fade-in {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        
        .animate-delay-1 { animation-delay: 0.1s; opacity: 0; }
        .animate-delay-2 { animation-delay: 0.2s; opacity: 0; }
        .animate-delay-3 { animation-delay: 0.3s; opacity: 0; }
        .animate-delay-4 { animation-delay: 0.4s; opacity: 0; }
        
        /* FUN ANIMATIONS - GPU ACCELERATED */
        
        /* Fade In Up Animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Fade In Animation */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Bounce Animation */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Pulse Animation */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Glow Animation */
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(102, 126, 234, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.8),
                            0 0 40px rgba(102, 126, 234, 0.4);
            }
        }
        
        /* Shimmer Animation */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        /* Float Animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        /* Rotate Glow */
        @keyframes rotateGlow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Scale In */
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* Slide In Right */
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* Slide In Left */
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* Apply Animations with Delays */
        .animate-fade-in {
            animation: fadeInUp 0.8s ease-out forwards;
            opacity: 0;
        }
        
        .animate-fade-in-fast {
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
        }
        
        .animate-scale-in {
            animation: scaleIn 0.6s ease-out forwards;
            opacity: 0;
        }
        
        .animate-slide-right {
            animation: slideInRight 0.8s ease-out forwards;
            opacity: 0;
        }
        
        .animate-slide-left {
            animation: slideInLeft 0.8s ease-out forwards;
            opacity: 0;
        }
        
        /* Staggered Animation Delays */
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }
        .delay-400 { animation-delay: 0.4s; }
        .delay-500 { animation-delay: 0.5s; }
        .delay-600 { animation-delay: 0.6s; }
        
        /* Continuous Animations */
        .pulse-slow {
            animation: pulse 3s ease-in-out infinite;
        }
        
        .bounce-slow {
            animation: bounce 2s ease-in-out infinite;
        }
        
        .float-slow {
            animation: float 6s ease-in-out infinite;
        }
        
        .glow-animate {
            animation: glow 2s ease-in-out infinite;
        }
        
        /* Card Hover Animations */
        .card {
            position: relative;
            will-change: transform;
        }
        
        .card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(102, 126, 234, 0.1),
                transparent
            );
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .card:hover::after {
            transform: translateX(100%);
        }
        
        /* Button Ripple Effect */
        .btn {
            position: relative;
            overflow: hidden;
            will-change: transform;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        /* Metric Number Count Animation */
        .metric-number {
            display: inline-block;
            will-change: transform;
            transition: all 0.3s ease;
        }
        
        .metric-number:hover {
            transform: scale(1.1);
        }
        
        /* Sparkline Canvas Animation */
        canvas {
            transition: opacity 0.3s ease;
        }
        
        canvas:hover {
            opacity: 0.8;
        }
        
        /* Icon Animations */
        .bi {
            display: inline-block;
            transition: transform 0.3s ease;
        }
        
        .card:hover .bi {
            transform: scale(1.2) rotate(5deg);
        }
        
        /* Progress Bar Animation */
        .progress-bar {
            animation: shimmer 2s linear infinite;
            background: linear-gradient(
                90deg,
                var(--primary-color) 0%,
                rgba(255, 255, 255, 0.3) 50%,
                var(--primary-color) 100%
            );
            background-size: 1000px 100%;
            will-change: background-position;
        }
        
        /* Navbar Logo Pulse */
        .navbar-brand i {
            animation: pulse 2s ease-in-out infinite;
        }
        
        /* Speed Test Button Special Animation */
        #btn-start-test {
            animation: glow 2s ease-in-out infinite;
            will-change: box-shadow;
        }
        
        #btn-start-test:hover {
            animation: pulse 0.5s ease-in-out infinite;
        }
        
        /* Smooth Scroll Behavior */
        html {
            scroll-behavior: smooth;
        }
        
        /* Reduce motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Mobile Responsiveness Improvements */
        @media (max-width: 768px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            h1 {
                font-size: 2rem !important;
            }
            
            h2, h3 {
                font-size: 1.5rem !important;
            }
            
            .display-4 {
                font-size: 2.5rem !important;
            }
            
            /* Stack metric cards vertically */
            .row.g-3 {
                gap: 0.75rem !important;
            }
            
            /* Better card spacing */
            .card {
                margin-bottom: 1rem;
            }
            
            /* Smaller display numbers */
            .display-4 {
                font-size: 2rem !important;
            }
            
            /* Better table on mobile */
            .table {
                font-size: 0.85rem;
            }
            
            .table td, .table th {
                padding: 0.5rem;
            }
            
            /* Map container mobile fix */
            #map-container {
                height: 300px !important;
                min-height: 300px;
            }
            
            /* Navbar adjustments */
            .navbar-brand {
                font-size: 0.95rem;
            }
            
            /* Button sizing */
            .btn {
                font-size: 0.9rem;
                padding: 0.5rem 1rem;
            }
        }
        
        @media (max-width: 576px) {
            /* Even smaller screens */
            .display-4 {
                font-size: 1.5rem !important;
            }
            
            h1 {
                font-size: 1.5rem !important;
            }
            
            h2, h3 {
                font-size: 1.25rem !important;
            }
            
            /* Single column layout */
            .col-6 {
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            #map-container {
                height: 250px !important;
            }
        }
    </style>
</head>
<body>
    <?php include 'components/header.php'; ?>
    <?php include 'components/metrics.php'; ?>
    <?php include 'components/map.php'; ?>
    <?php include 'components/leaderboard.php'; ?>
    <?php include 'components/share.php'; ?>
    <?php include 'components/footer.php'; ?>
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ============ GLOBAL STATE ============
        let currentLang = 'en';
        let testInProgress = false;
        let testAborted = false;
        let rateLimitUntil = null;
        let detectedInfo = { isp_name: 'Unknown', city: 'Unknown', asn: null };
        let lastTestResults = null;
        let shareUrl = null;
        
        // Sparkline data
        const sparklineData = {
            download: [],
            upload: [],
            ping: [],
            jitter: []
        };
        
        // ============ LANGUAGE TOGGLE ============
        function setLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-en]').forEach(el => {
                if (lang === 'en') {
                    el.textContent = el.dataset.en;
                } else {
                    el.textContent = el.dataset.ur || el.dataset.en;
                    el.classList.add('urdu-text');
                }
            });
            
            document.getElementById('btn-lang-en').classList.toggle('active', lang === 'en');
            document.getElementById('btn-lang-ur').classList.toggle('active', lang === 'ur');
            
            localStorage.setItem('lang', lang);
        }
        
        // ============ UTILITY FUNCTIONS ============
        function formatMbps(num) {
            return num > 0 ? num.toFixed(2) : '--';
        }
        
        function formatMs(num) {
            return num > 0 ? num.toFixed(1) : '--';
        }
        
        function hashToColor(str, speed = 0) {
            if (speed < 5) return '#dc3545'; // red
            if (speed < 20) return '#ffc107'; // yellow
            return '#198754'; // green
        }
        
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast-notification');
            const toastBody = document.getElementById('toast-message');
            
            toast.className = `toast align-items-center border-0 text-bg-${type}`;
            toastBody.textContent = message;
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
        
        function updateMetric(metric, value) {
            const el = document.getElementById(`metric-${metric}`);
            if (el) {
                el.textContent = typeof value === 'number' ? 
                    (metric === 'download' || metric === 'upload' ? formatMbps(value) : formatMs(value)) : 
                    value;
            }
        }
        
        // ============ SPARKLINE RENDERING ============
        function drawSparkline(canvasId, data, color) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            if (data.length < 2) return;
            
            const max = Math.max(...data, 1);
            const min = Math.min(...data);
            const range = max - min || 1;
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            data.forEach((value, index) => {
                const x = (index / (data.length - 1)) * width;
                const y = height - ((value - min) / range) * height;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
        }
        
        function updateSparkline(metric, value) {
            sparklineData[metric].push(value);
            if (sparklineData[metric].length > 20) {
                sparklineData[metric].shift();
            }
            
            const colors = {
                download: '#0d6efd',
                upload: '#198754',
                ping: '#0dcaf0',
                jitter: '#ffc107'
            };
            
            drawSparkline(`spark-${metric}`, sparklineData[metric], colors[metric]);
        }
        
        // ============ PAKISTAN MAP ============
        function initMap() {
            const canvas = document.getElementById('pakistan-map');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = canvas.offsetWidth * 2; // Retina support
            canvas.height = canvas.offsetHeight * 2;
            ctx.scale(2, 2);
            
            // Draw basic Pakistan outline (simplified)
            ctx.fillStyle = '#e9ecef';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Major city coordinates (approximate, normalized to canvas)
            const cities = {
                'Karachi': { x: 0.35, y: 0.85 },
                'Lahore': { x: 0.55, y: 0.35 },
                'Islamabad': { x: 0.58, y: 0.25 },
                'Rawalpindi': { x: 0.57, y: 0.26 },
                'Faisalabad': { x: 0.52, y: 0.42 },
                'Multan': { x: 0.48, y: 0.52 },
                'Hyderabad': { x: 0.38, y: 0.78 },
                'Quetta': { x: 0.22, y: 0.52 },
                'Peshawar': { x: 0.52, y: 0.18 },
                'Pakistan': { x: 0.45, y: 0.50 }
            };
            
            return { canvas, ctx, cities };
        }
        
        function updateMap(heatmapData) {
            const { ctx, cities } = initMap();
            const canvasWidth = document.getElementById('pakistan-map').offsetWidth;
            const canvasHeight = document.getElementById('pakistan-map').offsetHeight;
            
            heatmapData.forEach(item => {
                const coords = cities[item.city];
                if (!coords) return;
                
                const x = coords.x * canvasWidth;
                const y = coords.y * canvasHeight;
                const radius = Math.sqrt(item.tests) * 3 + 5;
                const color = hashToColor(item.city, item.avg_dl);
                
                // Draw bubble
                ctx.fillStyle = color + 'aa'; // with alpha
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Draw city label
                ctx.fillStyle = '#000';
                ctx.font = '10px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.city, x, y - radius - 5);
                ctx.fillText(item.avg_dl.toFixed(1) + ' Mbps', x, y - radius - 15);
            });
        }
        
        // ============ RATE LIMIT ============
        function checkRateLimit() {
            const stored = localStorage.getItem('rateLimitUntil');
            if (stored) {
                rateLimitUntil = parseInt(stored);
                if (rateLimitUntil > Date.now()) {
                    startCountdown();
                    return false;
                } else {
                    localStorage.removeItem('rateLimitUntil');
                    rateLimitUntil = null;
                }
            }
            return true;
        }
        
        function setRateLimit(seconds) {
            rateLimitUntil = Date.now() + (seconds * 1000);
            localStorage.setItem('rateLimitUntil', rateLimitUntil);
            startCountdown();
        }
        
        function startCountdown() {
            const btn = document.getElementById('btn-start-test');
            const notice = document.getElementById('rate-limit-notice');
            const timer = document.getElementById('countdown-timer');
            
            btn.disabled = true;
            notice.classList.remove('d-none');
            
            const interval = setInterval(() => {
                const remaining = Math.max(0, Math.floor((rateLimitUntil - Date.now()) / 1000));
                const minutes = Math.floor(remaining / 60);
                const seconds = remaining % 60;
                
                timer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (remaining <= 0) {
                    clearInterval(interval);
                    btn.disabled = false;
                    notice.classList.add('d-none');
                    rateLimitUntil = null;
                    localStorage.removeItem('rateLimitUntil');
                }
            }, 1000);
        }
        
        // ============ DETECT WHO AM I ============
        async function detectWhoAmI() {
            try {
                const response = await fetch('/api/whoami.php');
                const data = await response.json();
                
                detectedInfo = data;
                
                document.getElementById('info-isp').textContent = data.isp_name;
                document.getElementById('info-city').textContent = data.city;
                
                // Detect tech from navigator.connection
                let tech = 'Unknown';
                if (navigator.connection) {
                    const effectiveType = navigator.connection.effectiveType;
                    tech = effectiveType === '4g' ? '4G/LTE' : 
                           effectiveType === '3g' ? '3G' : 
                           effectiveType === 'slow-2g' || effectiveType === '2g' ? '2G' : 
                           'Wi-Fi/Broadband';
                }
                
                document.getElementById('info-tech').textContent = tech;
                
                // Check for outages
                checkForOutages(data.city);
                
                return data;
            } catch (error) {
                console.error('Failed to detect ISP info:', error);
                return { isp_name: 'Unknown', city: 'Unknown', asn: null };
            }
        }
        
        async function checkForOutages(city) {
            try {
                const response = await fetch(`/api/leaderboard.php?date=today&city=${encodeURIComponent(city)}`);
                const data = await response.json();
                
                if (data.spike) {
                    const banner = document.getElementById('outage-banner');
                    const message = document.getElementById('outage-message');
                    message.textContent = currentLang === 'en' ? 
                        `Network issues detected in ${city}. Test results may be affected.` :
                        `${city} میں نیٹ ورک کے مسائل کا پتہ چلا۔`;
                    banner.classList.remove('d-none');
                }
            } catch (error) {
                console.error('Failed to check outages:', error);
            }
        }
        
        // ============ SPEED TEST ============
        async function startSpeedTest() {
            if (testInProgress) return;
            
            if (!checkRateLimit()) {
                showToast(currentLang === 'en' ? 
                    'Please wait before testing again' : 
                    'برائے مہربانی دوبارہ ٹیسٹ سے پہلے انتظار کریں', 'warning');
                return;
            }
            
            testInProgress = true;
            testAborted = false;
            
            // Reset metrics
            ['download', 'upload', 'ping', 'jitter'].forEach(m => {
                updateMetric(m, '--');
                sparklineData[m] = [];
            });
            
            // Show progress
            document.getElementById('test-progress').classList.remove('d-none');
            document.getElementById('btn-start-test').disabled = true;
            
            // Detect ISP first
            await detectWhoAmI();
            
            try {
                // Step 1: Ping Test
                await runPingTest();
                if (testAborted) return;
                
                // Step 2: Download Test
                await runDownloadTest();
                if (testAborted) return;
                
                // Step 3: Upload Test
                await runUploadTest();
                if (testAborted) return;
                
                // Submit results
                await submitResults();
                
                showToast(currentLang === 'en' ? 
                    'Test completed successfully!' : 
                    'ٹیسٹ کامیابی سے مکمل ہوا!', 'success');
                
                // Set rate limit
                setRateLimit(600); // 10 minutes
                
            } catch (error) {
                console.error('Test failed:', error);
                showToast(currentLang === 'en' ? 
                    'Test failed. Please try again.' : 
                    'ٹیسٹ ناکام ہو گیا۔ دوبارہ کوشش کریں۔', 'danger');
            } finally {
                testInProgress = false;
                document.getElementById('test-progress').classList.add('d-none');
                if (!testAborted) {
                    document.getElementById('btn-start-test').disabled = false;
                }
            }
        }
        
        function cancelTest() {
            testAborted = true;
            testInProgress = false;
            document.getElementById('test-progress').classList.add('d-none');
            document.getElementById('btn-start-test').disabled = false;
            showToast(currentLang === 'en' ? 'Test cancelled' : 'ٹیسٹ منسوخ کر دیا گیا', 'info');
        }
        
        async function runPingTest() {
            updateProgress(10, currentLang === 'en' ? 'Testing ping...' : 'پنگ کی جانچ...');
            
            const pings = [];
            const iterations = 10;
            
            for (let i = 0; i < iterations; i++) {
                if (testAborted) return;
                
                const start = performance.now();
                await fetch('/api/ping.php?t=' + Date.now());
                const end = performance.now();
                
                const pingMs = end - start;
                pings.push(pingMs);
                
                const avgPing = pings.reduce((a, b) => a + b, 0) / pings.length;
                updateMetric('ping', avgPing);
                updateSparkline('ping', avgPing);
                
                await new Promise(r => setTimeout(r, 150));
            }
            
            // Calculate jitter (standard deviation)
            const avg = pings.reduce((a, b) => a + b, 0) / pings.length;
            const variance = pings.reduce((a, b) => a + Math.pow(b - avg, 2), 0) / pings.length;
            const jitter = Math.sqrt(variance);
            
            updateMetric('jitter', jitter);
            updateSparkline('jitter', jitter);
            
            lastTestResults = { ...lastTestResults, ping_ms: avg, jitter_ms: jitter };
        }
        
        async function runDownloadTest() {
            updateProgress(30, currentLang === 'en' ? 'Testing download speed...' : 'ڈاؤن لوڈ کی رفتار کی جانچ...');
            
            const startTime = performance.now();
            const duration = 12000; // 12 seconds
            const connections = 4;
            let totalBytes = 0;
            
            const downloadPromises = [];
            
            for (let i = 0; i < connections; i++) {
                downloadPromises.push((async () => {
                    while (performance.now() - startTime < duration && !testAborted) {
                        const response = await fetch('/speed/down.php?b=2&r=' + Math.random());
                        const reader = response.body.getReader();
                        
                        while (true) {
                            const { done, value } = await reader.read();
                            if (done || testAborted) break;
                            
                            totalBytes += value.length;
                            
                            const elapsed = (performance.now() - startTime) / 1000;
                            const mbps = (totalBytes * 8) / (elapsed * 1000000);
                            
                            updateMetric('download', mbps);
                            updateSparkline('download', mbps);
                            updateProgress(30 + (elapsed / duration) * 30);
                        }
                    }
                })());
            }
            
            await Promise.all(downloadPromises);
            
            const totalTime = (performance.now() - startTime) / 1000;
            const finalMbps = (totalBytes * 8) / (totalTime * 1000000);
            
            lastTestResults = { ...lastTestResults, dl_mbps: finalMbps };
        }
        
        async function runUploadTest() {
            updateProgress(60, currentLang === 'en' ? 'Testing upload speed...' : 'اپ لوڈ کی رفتار کی جانچ...');
            
            const startTime = performance.now();
            const duration = 10000; // 10 seconds
            const chunkSize = 512 * 1024; // 512 KB
            let totalBytes = 0;
            
            while (performance.now() - startTime < duration && !testAborted) {
                const chunk = new ArrayBuffer(chunkSize);
                const view = new Uint8Array(chunk);
                for (let i = 0; i < chunkSize; i++) {
                    view[i] = Math.floor(Math.random() * 256);
                }
                
                const uploadStart = performance.now();
                await fetch('/speed/up.php', {
                    method: 'POST',
                    body: chunk
                });
                
                totalBytes += chunkSize;
                
                const elapsed = (performance.now() - startTime) / 1000;
                const mbps = (totalBytes * 8) / (elapsed * 1000000);
                
                updateMetric('upload', mbps);
                updateSparkline('upload', mbps);
                updateProgress(60 + (elapsed / duration) * 30);
            }
            
            const totalTime = (performance.now() - startTime) / 1000;
            const finalMbps = (totalBytes * 8) / (totalTime * 1000000);
            
            lastTestResults = { ...lastTestResults, ul_mbps: finalMbps };
        }
        
        function updateProgress(percent, stage) {
            const bar = document.getElementById('progress-bar');
            const stageEl = document.getElementById('test-stage');
            
            bar.style.width = percent + '%';
            bar.setAttribute('aria-valuenow', percent);
            stageEl.textContent = stage;
        }
        
        async function submitResults() {
            updateProgress(95, currentLang === 'en' ? 'Submitting results...' : 'نتائج جمع کروا رہے ہیں...');
            
            const tech = document.getElementById('info-tech').textContent;
            const deviceType = /Mobile|Android|iPhone/i.test(navigator.userAgent) ? 'mobile' : 'desktop';
            
            const payload = {
                dl_mbps: lastTestResults.dl_mbps,
                ul_mbps: lastTestResults.ul_mbps,
                ping_ms: lastTestResults.ping_ms,
                jitter_ms: lastTestResults.jitter_ms,
                sample_ms: 30000,
                isp_name: detectedInfo.isp_name,
                asn: detectedInfo.asn,
                city: detectedInfo.city,
                tech: tech,
                device_type: deviceType
            };
            
            const response = await fetch('/api/submit.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            const data = await response.json();
            
            if (response.status === 429) {
                setRateLimit(data.retry_after || 600);
                throw new Error('Rate limited');
            }
            
            if (!response.ok) {
                throw new Error(data.error || 'Submission failed');
            }
            
            shareUrl = window.location.origin + data.share_url;
            enableShareButtons();
            
            updateProgress(100, currentLang === 'en' ? 'Complete!' : 'مکمل!');
            
            // Refresh leaderboard and map
            loadLeaderboard();
            loadHeatmap();
        }
        
        // ============ SHARE FUNCTIONS ============
        function enableShareButtons() {
            ['btn-copy-link', 'btn-share-twitter', 'btn-share-whatsapp', 'btn-share-facebook'].forEach(id => {
                document.getElementById(id).disabled = false;
            });
        }
        
        function getShareText() {
            const { dl_mbps, ul_mbps, ping_ms } = lastTestResults;
            return currentLang === 'en' ?
                `My internet speed today in ${detectedInfo.city} on ${detectedInfo.isp_name}: ${dl_mbps.toFixed(1)} Mbps / ${ul_mbps.toFixed(1)} Mbps, ping ${ping_ms.toFixed(0)} ms — via Pakistan Internet Speed Tracker` :
                `${detectedInfo.city} میں ${detectedInfo.isp_name} پر آج میری انٹرنیٹ کی رفتار: ${dl_mbps.toFixed(1)} Mbps / ${ul_mbps.toFixed(1)} Mbps, پنگ ${ping_ms.toFixed(0)} ms`;
        }
        
        function copyResultLink() {
            if (!shareUrl) return;
            navigator.clipboard.writeText(shareUrl);
            showToast(currentLang === 'en' ? 'Link copied!' : 'لنک کاپی ہو گیا!', 'success');
        }
        
        function shareToTwitter() {
            if (!shareUrl) return;
            const text = encodeURIComponent(getShareText());
            const url = encodeURIComponent(shareUrl);
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
        }
        
        function shareToWhatsApp() {
            if (!shareUrl) return;
            const text = encodeURIComponent(getShareText() + ' ' + shareUrl);
            window.open(`https://wa.me/?text=${text}`, '_blank');
        }
        
        function shareToFacebook() {
            if (!shareUrl) return;
            const url = encodeURIComponent(shareUrl);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
        }
        
        // ============ DATA LOADING ============
        async function loadLeaderboard() {
            try {
                const response = await fetch('/api/leaderboard.php?date=today');
                const data = await response.json();
                
                const tbody = document.getElementById('leaderboard-body');
                tbody.innerHTML = '';
                
                if (data.leaderboard.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="6" class="text-center text-muted py-4">
                        ${currentLang === 'en' ? 'No data available for today' : 'آج کے لیے کوئی ڈیٹا دستیاب نہیں'}
                    </td></tr>`;
                    return;
                }
                
                data.leaderboard.forEach((row, index) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="ps-3">${index + 1}</td>
                        <td><strong>${row.isp_name}</strong><br><small class="text-muted">${row.city}</small></td>
                        <td class="text-end">${row.avg_dl} Mbps</td>
                        <td class="text-end">${row.avg_ul} Mbps</td>
                        <td class="text-end">${row.avg_ping} ms</td>
                        <td class="text-end pe-3">${row.tests_count}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('Failed to load leaderboard:', error);
            }
        }
        
        async function loadHeatmap() {
            try {
                const response = await fetch('/api/heatmap.php?date=today');
                const data = await response.json();
                
                if (data.cities.length > 0) {
                    updateMap(data.cities);
                }
            } catch (error) {
                console.error('Failed to load heatmap:', error);
            }
        }
        
        // ============ INITIALIZATION ============
        document.addEventListener('DOMContentLoaded', () => {
            // Restore language preference
            const savedLang = localStorage.getItem('lang') || 'en';
            setLanguage(savedLang);
            
            // Check rate limit
            checkRateLimit();
            
            // Detect ISP info
            detectWhoAmI();
            
            // Load initial data
            loadLeaderboard();
            loadHeatmap();
            
            // Initialize map
            initMap();
            
            // Handle window resize for map
            window.addEventListener('resize', () => {
                initMap();
                loadHeatmap();
            });
        });
    </script>
</body>
</html>
